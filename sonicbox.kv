#:import MDNavigationDrawer kivymd.navigationdrawer.MDNavigationDrawer
#:import NavigationLayout kivymd.navigationdrawer.NavigationLayout
#:import NavigationDrawerToolbar kivymd.navigationdrawer.NavigationDrawerToolbar
#:import NavigationDrawerIconButton kivymd.navigationdrawer.NavigationDrawerIconButton
#:import Toolbar kivymd.toolbar.Toolbar

#:import DMPlayButton widgets.drum_machine_widgets.DMPlayButton
#:import DMStopButton widgets.drum_machine_widgets.DMStopButton
#:import DrumMachineScreen widgets.drum_machine_widgets.DrumMachineScreen
#:import DrumMachineKeyboard widgets.drum_machine_widgets.DrumMachineKeyboard
#:import SamplesCarousel widgets.samples_widgets.SamplesCarousel
#:import SamplesScreen widgets.samples_widgets.SamplesScreen
#:import SynthButton widgets.synth_widgets.SynthButton
#:import SynthKeyboard widgets.synth_widgets.SynthKeyboard
#:import SynthScreen widgets.synth_widgets.SynthScreen


NavigationLayout:
    id: nav_layout
    screens: scr_mngr

    MDNavigationDrawer:
        id: nav_drawer
        NavigationDrawerToolbar:
            title: "Sonicbox"
        NavigationDrawerIconButton:
            icon: 'checkbox-blank-circle'
            text: 'Samples'
            on_release: app.root.screens.current = 'samples'
        NavigationDrawerIconButton:
            icon: 'checkbox-blank-circle'
            text: 'Synth'
            on_release: app.root.screens.current = 'synth'
        NavigationDrawerIconButton:
            icon: 'checkbox-blank-circle'
            text: 'Drum Machine'
            on_release: app.root.screens.current = 'drum_machine'

    BoxLayout:
        orientation: 'vertical'

        Toolbar:
            id: toolbar
            size_hint_y: 0.08
            title: 'Sonicbox'
            md_bg_color: app.theme_cls.primary_color
            left_action_items: [['menu', lambda x: app.root.toggle_nav_drawer()]]

        ScreenManager:
            id: scr_mngr
            size_hint_y: 0.92
            current: 'drum_machine'
            
            SamplesScreen:
                id: samples_screen
            SynthScreen:
                id: synth_screen
            DrumMachineScreen:
                id: drum_machine_screen


<SamplesScreen>:
    name: 'samples'
    samples_groups: samples_carousel

    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y: 0.2

            Button:
                text: "<="
                size_hint_x: 0.1
                on_press: root.samples_groups.load_previous()
            Label:
                text: 'Samples'
                size_hint_x: 0.8
            Button:
                text: "=>"
                size_hint_x: 0.1
                on_press: root.samples_groups.load_next()

        SamplesCarousel:
            id: samples_carousel
            size_hint_y: 0.8


<SynthScreen>:
    name: "synth"
    
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: 0.2
            orientation: 'horizontal'
            
            SynthButton:
                id: synth_button
                current: "piano"
                text: "Synth: {}".format(self.current)
                on_release: self.open_bottom_sheet('synth')
            SynthButton:
                id: tonic_button
                current: "c1"
                text: "Tonic: {}".format(self.current)
                on_release: self.open_bottom_sheet('tonics')
            SynthButton:
                id: scale_button
                current: "major"
                text: "Scale: {}".format(self.current)
                on_release: self.open_bottom_sheet('scales')

        SynthKeyboard:
            size_hint_y: 0.8
            synth: synth_button.current
            tonic: tonic_button.current
            scale: scale_button.current


<DrumMachineScreen>:
    name: "drum_machine"
    keyboard: dm_keyboard

    BoxLayout:
        orientation: 'vertical'

        BoxLayout:
            size_hint_y: 0.2
            orientation: 'horizontal'
            bpm: bpm_textinput

            Label:
                text: 'BPM'
            TextInput:
                id: bpm_textinput
                text: '60'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x: 0.285

                DMPlayButton:
                    text: 'Play'
                    bpm_value: self.parent.parent.bpm.text
                DMStopButton:
                    text: 'Stop'

        DrumMachineKeyboard:
            id: dm_keyboard
            size_hint_y: 0.8
